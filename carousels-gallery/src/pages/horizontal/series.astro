---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Carousel Gallery">
  <section>
    <header>
      <h2>Seasons</h2>
      <div class="tags">
        <span>Scroll Markers</span>
        <span>Scroll-State Queries</span>
        <span>Scroll Initial Target</span>
        <span>Anchor</span>
        <span>Full Bleed</span>
      </div>
      <p>
        This one has snap points for every episode, but only generates markers
        for the first episode of a season. <code>scroll-marker-group</code> is set
        to before. <code>scroll-initial-target</code> scrolls to the first unseen
        item on load.
      </p>
    </header>

    <!-- todo: switch to a counter -->
    <ul class="carousel">
      <li class="season-start" data-season-content="1">
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/Freedom/300/200"
            width="350"
            height="233"
            alt="a field of tall grass with a blue sky"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 1</p>
            <p class="episode-title">Freedom Day</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>May 5, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/holston/300/200"
            width="350"
            height="233"
            alt="a grass field with a rusty oil barrel"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 2</p>
            <p class="episode-title">Holston's Pick</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>May 5, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/Machines/300/200"
            width="350"
            height="233"
            alt="The Golden Gate bridge on a foggy day"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 3</p>
            <p class="episode-title">Machines</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>May 12, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/truth/300/200"
            width="350"
            height="233"
            alt="A dark rocky, ocean coastline, and a gray sky"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 4</p>
            <p class="episode-title">Truth</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>May 19, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/boy/300/200"
            width="350"
            height="233"
            alt="a laptop and a mug of coffee on a desk"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 5</p>
            <p class="episode-title">The Janitor's Boy</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>May 19, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/theRelic/300/200"
            width="350"
            height="233"
            alt="Two rusty old cards parked in front of a garage"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 6</p>
            <p class="episode-title">The Relic</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>June 2, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/Flamekeepers/300/200"
            width="350"
            height="233"
            alt="A skateboarder shown catching air at a skatepark"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 7</p>
            <p class="episode-title">The Flamekeepers</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>June 9, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/Hanna/300/200"
            width="350"
            height="233"
            alt="A dark forest with a ray of sunshine breaking through the trees"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 8</p>
            <p class="episode-title">Hanna</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>June 16, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/Getaway/300/200"
            width="350"
            height="233"
            alt="A field of lavender"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 9</p>
            <p class="episode-title">The Getaway</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>June 23, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/Outside/300/200"
            width="350"
            height="233"
            alt="A tall corporate tower photographed from the ground looking up"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 10</p>
            <p class="episode-title">Outside</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>June 30, 2023</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>

      <li class="season-start" data-season-content="2">
        <figure class="episode seen">
          <img
            src="https://picsum.photos/seed/Engineer/300/200"
            width="350"
            height="233"
            alt="A forested mountain range with a lake in the foreground"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 1</p>
            <p class="episode-title">The Engineer</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>November 15, 2024</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode">
          <img
            src="https://picsum.photos/seed/Order/300/200"
            width="350"
            height="233"
            alt="A foggy overview of many mountains"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 2</p>
            <p class="episode-title">Order</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>November 15, 2024</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode">
          <img
            src="https://picsum.photos/seed/Solo/300/200"
            width="350"
            height="233"
            alt="A phone on a table"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 3</p>
            <p class="episode-title">Solo</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>November 27, 2024</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode">
          <img
            src="https://picsum.photos/seed/Harmonium/300/200"
            width="350"
            height="233"
            alt="A trail in a grassy medow trailing away into the distance"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 4</p>
            <p class="episode-title">The Harmonium</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>December 4, 2024</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
      <li>
        <figure class="episode unreleased">
          <img
            src="https://picsum.photos/seed/unreleased/300/200"
            width="350"
            height="233"
            alt="A sparse landscape of rolling hills"
            tabindex="0"
          />
          <figcaption class="episode-details">
            <p class="episode-number">Episode 5</p>
            <p class="episode-title">Coming Soon</p>
            <p class="episode-description">
              Lorem ipsum dolor sit amet, consectetur adipisicing elit.
            </p>
            <p class="episode-meta">
              <span>44min</span>
              <time>December 11, 2024</time>
              <span class="episode-badge">TV-MA</span>
              <span class="episode-badge">HDR</span>
            </p>
          </figcaption>
        </figure>
      </li>
    </ul>
  </section>
</Layout>

<style>
  .carousel {
    /* Reset list styles */
    list-style-type: none;
    counter-reset: item;

    /* Styles and layout */
    inline-size: 100cqi;
    padding-block-start: var(--size-3); /* focus needs the space */
    padding-inline: 5vmin;
    scroll-padding-inline: 5vmin;

    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 350px;
    gap: 5vmin;

    scroll-marker-group: before;
    margin-block-start: 2lh; /* 2 lines for the markers */

    &::scroll-marker-group {
      position: absolute;
      position-anchor: --carousel;
      inset-inline-start: anchor(left);
      inset-block-end: anchor(top);
      margin-inline-start: 5vmin;

      block-size: 1lh;
      display: flex;
      gap: var(--size-7);
    }

    &::before,
    &::after {
      content: "";
      display: block;
      inline-size: 85cqi;
    }

    & > li {
      padding: 0;
      position: relative;

      /* scroll to the first unseen item */
      &:nth-child(1 of :has(figure:not(.seen))) {
        scroll-initial-target: nearest;
      }

      &.season-start::scroll-marker {
        content: "Season " attr(data-season-content);
        white-space: nowrap;
        font-size: var(--font-size-3);
        font-variation-settings: "wght" 300;
        text-underline-offset: 5px;
        cursor: pointer;
        transition: font-variation-settings 0.3s ease;
      }

      &.season-start::scroll-marker:target-current {
        text-decoration: underline 2px light-dark(hotpink, yellow);
        font-variation-settings: "wght" 800;
      }
    }
  }

  .episode {
    display: grid;
    line-height: 1.25;
    anchor-name: --episode;
    anchor-scope: --episode;

    &.seen::after {
      content: "✓";

      position: absolute;
      position-anchor: --episode;
      /* position-visibility: hidden; */
      top: anchor(top);
      right: anchor(right);
      margin: var(--size-3);
      color: white;

      display: inline-grid;
      place-items: center;
      inline-size: var(--size-5);
      aspect-ratio: 1;
      border-radius: var(--radius-round);
      border: 1px solid white;
    }

    &.unreleased {
      opacity: 0.25;
    }

    > img {
      background-color: var(--surface-3);
      border-radius: var(--radius-2);

      @container not scroll-state(snapped: inline) {
        filter: grayscale(1);
      }
    }

    > figcaption {
      > .episode-number {
        text-transform: uppercase;
        font-weight: 500;
        font-size: var(--font-size-0);
      }

      > .episode-title {
        font-size: var(--font-size-3);
        font-weight: bold;
        line-height: 1cap;
        margin-block-start: var(--size-1);
      }

      > .episode-description {
        margin-block: var(--size-2);
        font-weight: 300;
        font-size: var(--font-size-3);
      }

      > .episode-meta {
        display: flex;
        align-items: baseline;
        gap: var(--size-2);
        font-size: var(--font-size-1);

        > .episode-badge {
          line-height: 1cap;
          padding: var(--size-1);
          border-radius: var(--radius-2);
          border: 1px solid var(--surface-4);
        }
      }
    }
  }
</style>
